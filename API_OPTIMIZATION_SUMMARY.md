# API 호출 및 전적검색 로직 최적화 개선 사항

## 개선 목표
- 저사양 환경에서도 원활한 동작
- 트래픽 몰림 방지
- API 호출량 최소화
- 빠른 응답 속도
- 정확한 데이터 제공

## 주요 개선 사항

### 1. 검색 로직 DB 캐시 우선 확인 (백엔드)
**파일**: `PlayerController.java`, `SearchService.java`

**개선 내용**:
- 검색 요청 시 외부 API 호출 전에 DB 캐시(SearchHistory)를 먼저 확인
- 캐시에 OUID가 있으면 즉시 반환 (API 호출 없음)
- 캐시에 없을 때만 외부 API 호출
- 검색 기록 저장을 비동기 처리하여 응답 속도 향상

**효과**:
- 반복 검색 시 API 호출 완전 제거
- 응답 시간 단축 (DB 조회 vs 외부 API 호출)
- 외부 API 호출량 대폭 감소

### 2. 프로필 API 병렬 처리 (백엔드)
**파일**: `ProfileService.java`

**개선 내용**:
- 순차 API 호출 → 병렬 처리 (CompletableFuture 사용)
- 4개 API (basic, rank, tier, recent)를 동시에 호출
- 최대 10초 타임아웃 설정
- 부분 실패 허용 (일부 API 실패해도 나머지 결과 반환)

**효과**:
- API 호출 시간 약 75% 단축 (순차 → 병렬)
- 전체 응답 시간 대폭 개선

### 3. 매치 정보 지연 로딩 (백엔드)
**파일**: `ProfileService.java`

**개선 내용**:
- 프로필 조회 시 자동 매치 정보 조회 제거
- 사용자가 매치 목록을 요청할 때만 조회

**효과**:
- 초기 프로필 조회 속도 향상
- 불필요한 API 호출 제거
- 트래픽 분산

### 4. 프론트엔드 검색 캐싱 및 디바운싱
**파일**: `playerApi.ts`

**개선 내용**:
- 로컬 메모리 캐시 추가 (1시간 TTL)
- 검색 API 디바운싱 (500ms)
- 동시 요청 병합 처리
- 프로필 조회 시 refresh=false일 때만 병합 적용

**효과**:
- 동일 닉네임 반복 검색 시 API 호출 제거
- 빠른 타이핑 시 불필요한 API 호출 방지
- 동시 요청 중복 제거

### 5. 플레이어 비교 최적화 (백엔드)
**파일**: `ProfileService.java`

**개선 내용**:
- 프로필 데이터 재사용으로 추가 API 호출 제거
- 캐시된 인사이트 통계 활용

**효과**:
- 비교 기능 API 호출량 감소

## 성능 개선 예상 효과

### API 호출량 감소
- **검색 API**: 반복 검색 시 100% 감소 (DB 캐시 활용)
- **프로필 API**: 병렬 처리로 응답 시간 단축, 매치 자동 조회 제거로 호출 감소
- **전체 예상**: 약 60-80% API 호출량 감소

### 응답 속도 개선
- **검색 (캐시 히트)**: DB 조회만 수행 → 약 10-50ms
- **검색 (캐시 미스)**: 외부 API 호출 → 기존과 동일
- **프로필 조회**: 병렬 처리로 약 75% 시간 단축
- **초기 로딩**: 매치 자동 조회 제거로 약 1-2초 단축

### 트래픽 분산
- DB 캐시 우선 확인으로 외부 API 트래픽 감소
- 디바운싱으로 연속 요청 제어
- 지연 로딩으로 초기 부하 감소

## 사용 가이드

### 백엔드 설정
- 현재 설정 그대로 사용 가능
- Redis가 설정되어 있으면 자동으로 Redis 캐시 사용
- Redis가 없으면 Caffeine 로컬 캐시 사용

### 프론트엔드 설정
- 추가 설정 불필요
- 자동으로 캐싱 및 디바운싱 적용

## 주의사항

1. **검색 캐시**: SearchHistory 테이블에 OUID가 저장되어 있어야 DB 캐시가 동작합니다.
2. **프로필 캐시**: Redis 또는 Caffeine 캐시가 설정되어 있어야 효과적입니다.
3. **프론트엔드 캐시**: 브라우저 새로고침 시 메모리 캐시가 초기화됩니다.

## 추가 최적화 가능 사항

1. **Redis 캐시 TTL 조정**: 사용 패턴에 맞게 캐시 유지 시간 조정
2. **검색 기록 만료 정책**: 오래된 검색 기록 정리 스케줄러 추가
3. **배치 처리**: 여러 플레이어 프로필을 한 번에 조회하는 배치 API 추가
4. **CDN 활용**: 정적 리소스 캐싱 추가
